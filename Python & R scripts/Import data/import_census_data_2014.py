# -*- coding: utf-8 -*-
"""
Created on Tue May 15 18:03:55 2018

@author: anupriyat
"""

from census import Census
import us
import psycopg2
import pandas as pd
from psycopg2 import sql

c = Census("6e10af233e8ed9c9b8bc737c86e434ead388ebec")

 
allcount = pd.read_csv(r'county_list_v2.csv', dtype={'state_code': object, 'county_code': object} )

conn = psycopg2.connect(database="postgres", user = "postgres", password = "SelectALL2017", host = "104.197.103.221", port = "5432")
cur = conn.cursor()

#usa=us.states.mapping('fips', 'abbr')
usa = {"02" : "AK"}

for x in usa:
    
    counties=allcount.loc[allcount['state_code'] == x]
    cur.execute("""DROP TABLE IF EXISTS acs_2014_%s;""" % usa[x])
    cur.execute("""CREATE TABLE acs_2014_%s
                (
                 B01001_001E FLOAT,
                B01001_002E FLOAT,
                NAME TEXT,
                BLKGRP TEXT,
                COUNTY TEXT,
                STATE TEXT,
                TRACT TEXT);""" % usa[x]) 
    print ("Table created successfully")
    tbl = 'acs_2014_'+usa[x].lower()
    conn.commit()

    for index, row in counties.iterrows():

        blkdata=c.acs5.state_county_blockgroup(('NAME','B01001_001E', 'B01001_002E', 'B01001_003E', 'B01001_004E', 'B01001_005E', 'B01001_006E', 'B01001_007E', 'B01001_008E', 'B01001_009E', 'B01001_010E', 'B01001_011E', 'B01001_012E', 'B01001_013E', 'B01001_014E', 'B01001_015E', 'B01001_016E', 'B01001_017E', 'B01001_018E', 'B01001_019E', 'B01001_020E', 'B01001_021E', 'B01001_022E', 'B01001_023E', 'B01001_024E', 'B01001_025E', 'B01001_026E', 'B01001_027E', 'B01001_028E', 'B01001_029E', 'B01001_030E', 'B01001_031E', 'B01001_032E', 'B01001_033E', 'B01001_034E', 'B01001_035E', 'B01001_036E', 'B01001_037E', 'B01001_038E', 'B01001_039E', 'B01001_040E', 'B01001_041E', 'B01001_042E', 'B01001_043E', 'B01001_044E', 'B01001_045E', 'B01001_046E', 'B01001_047E', 'B01001_048E', 'B01001_049E', 'B01003_001E', 'B02001_001E', 'B02001_002E', 'B02001_003E', 'B02001_004E', 'B02001_005E', 'B02001_006E', 'B02001_007E', 'B02001_008E', 'B02001_009E', 'B02001_010E', 'B08135_001E', 'B08135_002E', 'B08135_003E', 'B08135_004E', 'B08135_005E', 'B08135_006E', 'B08135_007E', 'B08135_008E', 'B08135_009E', 'B08135_010E', 'B08301_001E', 'B08301_002E', 'B08301_003E', 'B08301_004E', 'B08301_005E', 'B08301_006E', 'B08301_007E', 'B08301_008E', 'B08301_009E', 'B08301_010E', 'B08301_011E', 'B08301_012E', 'B08301_013E', 'B08301_014E', 'B08301_015E', 'B08301_016E', 'B08301_017E', 'B08301_018E', 'B08301_019E', 'B08301_020E', 'B08301_021E', 'B08302_001E', 'B08302_002E', 'B08302_003E', 'B08302_004E', 'B08302_005E', 'B08302_006E', 'B08302_007E', 'B08302_008E', 'B08302_009E', 'B08302_010E', 'B08302_011E', 'B08302_012E', 'B08302_013E', 'B08302_014E', 'B08302_015E', 'B08303_001E', 'B08303_002E', 'B08303_003E', 'B08303_004E', 'B08303_005E', 'B08303_006E', 'B08303_007E', 'B08303_008E', 'B08303_009E', 'B08303_010E', 'B08303_011E', 'B08303_012E', 'B08303_013E', 'B11001_001E', 'B11001_002E', 'B11001_003E', 'B11001_004E', 'B11001_005E', 'B11001_006E', 'B11001_007E', 'B11001_008E', 'B11001_009E', 'B11016_001E', 'B11016_002E', 'B11016_003E', 'B11016_004E', 'B11016_005E', 'B11016_006E', 'B11016_007E', 'B11016_008E', 'B11016_009E', 'B11016_010E', 'B11016_011E', 'B11016_012E', 'B11016_013E', 'B11016_014E', 'B11016_015E', 'B11016_016E', 'B19001_001E', 'B19001_002E', 'B19001_003E', 'B19001_004E', 'B19001_005E', 'B19001_006E', 'B19001_007E', 'B19001_008E', 'B19001_009E', 'B19001_010E', 'B19001_011E', 'B19001_012E', 'B19001_013E', 'B19001_014E', 'B19001_015E', 'B19001_016E', 'B19001_017E', 'B19037_001E', 'B19037_002E', 'B19037_003E', 'B19037_004E', 'B19037_005E', 'B19037_006E', 'B19037_007E', 'B19037_008E', 'B19037_009E', 'B19037_010E', 'B19037_011E', 'B19037_012E', 'B19037_013E', 'B19037_014E', 'B19037_015E', 'B19037_016E', 'B19037_017E', 'B19037_018E', 'B19037_019E', 'B19037_020E', 'B19037_021E', 'B19037_022E', 'B19037_023E', 'B19037_024E', 'B19037_025E', 'B19037_026E', 'B19037_027E', 'B19037_028E', 'B19037_029E', 'B19037_030E', 'B19037_031E', 'B19037_032E', 'B19037_033E', 'B19037_034E', 'B19037_035E', 'B19037_036E', 'B19037_037E', 'B19037_038E', 'B19037_039E', 'B19037_040E', 'B19037_041E', 'B19037_042E', 'B19037_043E', 'B19037_044E', 'B19037_045E', 'B19037_046E', 'B19037_047E', 'B19037_048E', 'B19037_049E', 'B19037_050E', 'B19037_051E', 'B19037_052E', 'B19037_053E', 'B19037_054E', 'B19037_055E', 'B19037_056E', 'B19037_057E', 'B19037_058E', 'B19037_059E', 'B19037_060E', 'B19037_061E', 'B19037_062E', 'B19037_063E', 'B19037_064E', 'B19037_065E', 'B19037_066E', 'B19037_067E', 'B19037_068E', 'B19037_069E', 'B19051_001E', 'B19051_002E', 'B19051_003E', 'B19301_001E', 'B20001_001E', 'B20001_002E', 'B20001_003E', 'B20001_004E', 'B20001_005E', 'B20001_006E', 'B20001_007E', 'B20001_008E', 'B20001_009E', 'B20001_010E', 'B20001_011E', 'B20001_012E', 'B20001_013E', 'B20001_014E', 'B20001_015E', 'B20001_016E', 'B20001_017E', 'B20001_018E', 'B20001_019E', 'B20001_020E', 'B20001_021E', 'B20001_022E', 'B20001_023E', 'B20001_024E', 'B20001_025E', 'B20001_026E', 'B20001_027E', 'B20001_028E', 'B20001_029E', 'B20001_030E', 'B20001_031E', 'B20001_032E', 'B20001_033E', 'B20001_034E', 'B20001_035E', 'B20001_036E', 'B20001_037E', 'B20001_038E', 'B20001_039E', 'B20001_040E', 'B20001_041E', 'B20001_042E', 'B20001_043E', 'B20002_001E', 'B20002_002E', 'B20002_003E', 'B23022_001E', 'B23022_002E', 'B23022_003E', 'B23022_004E', 'B23022_005E', 'B23022_006E', 'B23022_007E', 'B23022_008E', 'B23022_009E', 'B23022_010E', 'B23022_011E', 'B23022_012E', 'B23022_013E', 'B23022_014E', 'B23022_015E', 'B23022_016E', 'B23022_017E', 'B23022_018E', 'B23022_019E', 'B23022_020E', 'B23022_021E', 'B23022_022E', 'B23022_023E', 'B23022_024E', 'B23022_025E', 'B23022_026E', 'B23022_027E', 'B23022_028E', 'B23022_029E', 'B23022_030E', 'B23022_031E', 'B23022_032E', 'B23022_033E', 'B23022_034E', 'B23022_035E', 'B23022_036E', 'B23022_037E', 'B23022_038E', 'B23022_039E', 'B23022_040E', 'B23022_041E', 'B23022_042E', 'B23022_043E', 'B23022_044E', 'B23022_045E', 'B23022_046E', 'B23022_047E', 'B23022_048E', 'B23022_049E', 'C24010_001E', 'C24010_002E', 'C24010_003E', 'C24010_004E', 'C24010_005E', 'C24010_006E', 'C24010_007E', 'C24010_008E', 'C24010_009E', 'C24010_010E', 'C24010_011E', 'C24010_012E', 'C24010_013E', 'C24010_014E', 'C24010_015E', 'C24010_016E', 'C24010_017E', 'C24010_018E', 'C24010_019E', 'C24010_020E', 'C24010_021E', 'C24010_022E', 'C24010_023E', 'C24010_024E', 'C24010_025E', 'C24010_026E', 'C24010_027E', 'C24010_028E', 'C24010_029E', 'C24010_030E', 'C24010_031E', 'C24010_032E', 'C24010_033E', 'C24010_034E', 'C24010_035E', 'C24010_036E', 'C24010_037E', 'C24010_038E', 'C24010_039E', 'C24010_040E', 'C24010_041E', 'C24010_042E', 'C24010_043E', 'C24010_044E', 'C24010_045E', 'C24010_046E', 'C24010_047E', 'C24010_048E', 'C24010_049E', 'C24010_050E', 'C24010_051E', 'C24010_052E', 'C24010_053E', 'C24010_054E', 'C24010_055E', 'C24010_056E', 'C24010_057E', 'C24010_058E', 'C24010_059E', 'C24010_060E', 'C24010_061E', 'C24010_062E', 'C24010_063E', 'C24010_064E', 'C24010_065E', 'C24010_066E', 'C24010_067E', 'C24010_068E', 'C24010_069E', 'C24010_070E', 'C24010_071E', 'C24010_072E', 'C24010_073E', 'B25001_001E', 'B25002_001E', 'B25002_002E', 'B25002_003E', 'B25003_001E', 'B25003_002E', 'B25003_003E', 'B25003A_001E', 'B25003A_002E', 'B25003A_003E', 'B25003B_001E', 'B25003B_002E', 'B25003B_003E', 'B25003C_001E', 'B25003C_002E', 'B25003C_003E', 'B25003D_001E', 'B25003D_002E', 'B25003D_003E', 'B25003E_001E', 'B25003E_002E', 'B25003E_003E', 'B25003F_001E', 'B25003F_002E', 'B25003F_003E', 'B25003G_001E', 'B25003G_002E', 'B25003G_003E', 'B25003H_001E', 'B25003H_002E', 'B25003H_003E', 'B25003I_001E', 'B25003I_002E', 'B25003I_003E', 'B25004_001E', 'B25004_002E', 'B25004_003E', 'B25004_004E', 'B25004_005E', 'B25004_006E', 'B25004_007E', 'B25004_008E', 'B25006_001E', 'B25006_002E', 'B25006_003E', 'B25006_004E', 'B25006_005E', 'B25006_006E', 'B25006_007E', 'B25006_008E', 'B25006_009E', 'B25006_010E', 'B25007_001E', 'B25007_002E', 'B25007_003E', 'B25007_004E', 'B25007_005E', 'B25007_006E', 'B25007_007E', 'B25007_008E', 'B25007_009E', 'B25007_010E', 'B25007_011E', 'B25007_012E', 'B25007_013E', 'B25007_014E', 'B25007_015E', 'B25007_016E', 'B25007_017E', 'B25007_018E', 'B25007_019E', 'B25007_020E', 'B25007_021E', 'B25008_001E', 'B25008_002E', 'B25008_003E', 'B25009_001E', 'B25009_002E', 'B25009_003E', 'B25009_004E', 'B25009_005E', 'B25009_006E', 'B25009_007E', 'B25009_008E', 'B25009_009E', 'B25009_010E', 'B25009_011E', 'B25009_012E', 'B25009_013E', 'B25009_014E', 'B25009_015E', 'B25009_016E', 'B25009_017E', 'B25017_001E', 'B25017_002E', 'B25017_003E', 'B25017_004E', 'B25017_005E', 'B25017_006E', 'B25017_007E', 'B25017_008E', 'B25017_009E', 'B25017_010E', 'B25020_001E', 'B25020_002E', 'B25020_003E', 'B25020_004E', 'B25020_005E', 'B25020_006E', 'B25020_007E', 'B25020_008E', 'B25020_009E', 'B25020_010E', 'B25020_011E', 'B25020_012E', 'B25020_013E', 'B25020_014E', 'B25020_015E', 'B25020_016E', 'B25020_017E', 'B25020_018E', 'B25020_019E', 'B25020_020E', 'B25020_021E', 'B25021_001E', 'B25021_002E', 'B25021_003E', 'B25022_001E', 'B25022_002E', 'B25022_003E', 'B25024_001E', 'B25024_002E', 'B25024_003E', 'B25024_004E', 'B25024_005E', 'B25024_006E', 'B25024_007E', 'B25024_008E', 'B25024_009E', 'B25024_010E', 'B25024_011E', 'B25032_001E', 'B25032_002E', 'B25032_003E', 'B25032_004E', 'B25032_005E', 'B25032_006E', 'B25032_007E', 'B25032_008E', 'B25032_009E', 'B25032_010E', 'B25032_011E', 'B25032_012E', 'B25032_013E', 'B25032_014E', 'B25032_015E', 'B25032_016E', 'B25032_017E', 'B25032_018E', 'B25032_019E', 'B25032_020E', 'B25032_021E', 'B25032_022E', 'B25032_023E', 'B25033_001E', 'B25033_002E', 'B25033_003E', 'B25033_004E', 'B25033_005E', 'B25033_006E', 'B25033_007E', 'B25033_008E', 'B25033_009E', 'B25033_010E', 'B25033_011E', 'B25033_012E', 'B25033_013E', 'B25034_001E', 'B25034_002E', 'B25034_003E', 'B25034_004E', 'B25034_005E', 'B25034_006E', 'B25034_007E', 'B25034_008E', 'B25034_009E', 'B25034_010E', 'B25036_001E', 'B25036_002E', 'B25036_003E', 'B25036_004E', 'B25036_005E', 'B25036_006E', 'B25036_007E', 'B25036_008E', 'B25036_009E', 'B25036_010E', 'B25036_011E', 'B25036_012E', 'B25036_013E', 'B25036_014E', 'B25036_015E', 'B25036_016E', 'B25036_017E', 'B25036_018E', 'B25036_019E', 'B25036_020E', 'B25036_021E', 'B25041_001E', 'B25041_002E', 'B25041_003E', 'B25041_004E', 'B25041_005E', 'B25041_006E', 'B25041_007E', 'B25056_001E', 'B25056_002E', 'B25056_003E', 'B25056_004E', 'B25056_005E', 'B25056_006E', 'B25056_007E', 'B25056_008E', 'B25056_009E', 'B25056_010E', 'B25056_011E', 'B25056_012E', 'B25056_013E', 'B25056_014E', 'B25056_015E', 'B25056_016E', 'B25056_017E', 'B25056_018E', 'B25056_019E', 'B25056_020E', 'B25056_021E', 'B25056_022E', 'B25056_023E', 'B25056_024E', 'B25061_001E', 'B25061_002E', 'B25061_003E', 'B25061_004E', 'B25061_005E', 'B25061_006E', 'B25061_007E', 'B25061_008E', 'B25061_009E', 'B25061_010E', 'B25061_011E', 'B25061_012E', 'B25061_013E', 'B25061_014E', 'B25061_015E', 'B25061_016E', 'B25061_017E', 'B25061_018E', 'B25061_019E', 'B25061_020E', 'B25061_021E', 'B25061_022E', 'B25062_001E', 'B25063_001E', 'B25063_002E', 'B25063_003E', 'B25063_004E', 'B25063_005E', 'B25063_006E', 'B25063_007E', 'B25063_008E', 'B25063_009E', 'B25063_010E', 'B25063_011E', 'B25063_012E', 'B25063_013E', 'B25063_014E', 'B25063_015E', 'B25063_016E', 'B25063_017E', 'B25063_018E', 'B25063_019E', 'B25063_020E', 'B25063_021E', 'B25063_022E', 'B25063_023E', 'B25063_024E', 'B25068_001E', 'B25068_002E', 'B25068_003E', 'B25068_004E', 'B25068_005E', 'B25068_006E', 'B25068_007E', 'B25068_008E', 'B25068_009E', 'B25068_010E', 'B25068_011E', 'B25068_012E', 'B25068_013E', 'B25068_014E', 'B25068_015E', 'B25068_016E', 'B25068_017E', 'B25068_018E', 'B25068_019E', 'B25068_020E', 'B25068_021E', 'B25068_022E', 'B25068_023E', 'B25068_024E', 'B25068_025E', 'B25068_026E', 'B25068_027E', 'B25068_028E', 'B25068_029E', 'B25068_030E', 'B25068_031E', 'B25068_032E', 'B25068_033E', 'B25068_034E', 'B25068_035E', 'B25068_036E', 'B25068_037E', 'B25070_001E', 'B25070_002E', 'B25070_003E', 'B25070_004E', 'B25070_005E', 'B25070_006E', 'B25070_007E', 'B25070_008E', 'B25070_009E', 'B25070_010E', 'B25070_011E', 'B25075_001E', 'B25075_002E', 'B25075_003E', 'B25075_004E', 'B25075_005E', 'B25075_006E', 'B25075_007E', 'B25075_008E', 'B25075_009E', 'B25075_010E', 'B25075_011E', 'B25075_012E', 'B25075_013E', 'B25075_014E', 'B25075_015E', 'B25075_016E', 'B25075_017E', 'B25075_018E', 'B25075_019E', 'B25075_020E', 'B25075_021E', 'B25075_022E', 'B25075_023E', 'B25075_024E', 'B25075_025E', 'B25085_001E', 'B25085_002E', 'B25085_003E', 'B25085_004E', 'B25085_005E', 'B25085_006E', 'B25085_007E', 'B25085_008E', 'B25085_009E', 'B25085_010E', 'B25085_011E', 'B25085_012E', 'B25085_013E', 'B25085_014E', 'B25085_015E', 'B25085_016E', 'B25085_017E', 'B25085_018E', 'B25085_019E', 'B25085_020E', 'B25085_021E', 'B25085_022E', 'B25085_023E', 'B25085_024E', 'B25085_025E'), row['state_code'], row['county_code'], Census.ALL, year=2014)
        cur.executemany(
                sql.SQL("INSERT INTO {} \
                        VALUES ( \
                        %(B01001_001E)s, \
                        %(B01001_002E)s, \
                        %(tract)s);")
                .format(sql.Identifier(tbl)), blkdata)
        conn.commit()
        print ("Table populated successfully %s %s" % (row['state_code'], row['county_code']))
    
conn.close()






